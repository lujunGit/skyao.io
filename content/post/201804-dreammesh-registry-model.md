+++
title = "DreamMesh服务注册(1)-统一模型"

date = 2018-04-16
lastmod = 2018-04-16
draft = false

tags = ["DreamMesh", "服务注册"]
summary = "在前面的讨论中，我们探索了打通多个服务注册中心的思路。另外在服务治理中心的构想，也是希望能提供统一的方式对各家微服务体系进行服务治理。而要做到这两点，服务注册模型的统一势在必行。"
abstract = "在前面的讨论中，我们探索了打通多个服务注册中心的思路。另外在服务治理中心的构想，也是希望能提供统一的方式对各家微服务体系进行服务治理。而要做到这两点，服务注册模型的统一势在必行。"

[header]
image = "headers/dreammesh-registry-1.jpg"
caption = ""

+++

在前面的讨论中，我们探索了打通多个服务注册中心的思路。另外在服务治理中心的构想，也是希望能提供统一的方式对各家微服务体系进行服务治理。

而要做到这两点，服务注册模型的统一势在必行。

## 背景回顾

首先回顾一下，需求来自哪里：

1. Service Mesh体系和非Service Mesh体系并存/过渡的需要

  见前文 [DreamMesh抛砖引玉(3)-艰难的过渡](../201802-dreammesh-brainstorm-transition/)。

2. 多集群部署的需要

  见前文 [DreamMesh抛砖引玉(10)-多集群](../201804-dreammesh-brainstorm-mutiple-cluster/)

这两个需要迫使我们要想办法打通多个服务注册体系，使得他们可以相互交换数据，从而实现服务跨集群的彼此感知。

要实现这个想法，需要做到几点：

1. 能够跨集群的交换服务注册数据
2. 能够理解交换而来的服务注册数据
3. SDK有能力根据服务注册数据实现跨集群的请求发送

我们先来关注第二点：如何让多个服务注册体系彼此理解对方的服务注册数据？

## 模型是关键

每个服务注册体系，都会有自己的服务注册模型，记录服务注册时提交的信息，以便在服务发现时返回。简单的信息如IP，端口告知客户端"我在哪"，复杂一点的则典型如k8s中引入的label，可以实现基于lable的过滤。

服务注册模型通常都不会太过复杂，尤其是常见的基本信息大体上各家实现上大同小异。

但是，基本上，每家都是各自设计自己的一套模型，起码目前看不到有任何规范或者协同的迹象。因此，当今天我们试图打通多个服务注册体系时，面临的第一个事情，就是如何统一这些服务注册模型。

### 理想化的模型

先看看最理想的状态，如果我们能够提炼出一个统一的服务注册模型，然后让自家的服务注册产品都遵循这个统一模型。

![](images/unified-model.jpg)

当然，自家的底层实现是可以完全不同的，各自发挥，但是最终对外都表现为一个统一的模型。类似于代码里面的interface和类实现，这里就是一个规范模型+各种具体实现。

### 基于统一模型的体系

有了统一的服务注册模型，上层的注册中心，以及更上层的服务治理中心，就可以依托于这个统一模型，实现统一。

![](images/unified-registry.jpg)

待续......

## 讨论和反馈

TBD：等收集后整理更新

## 后记

有兴趣的朋友，请联系我的微信，加入Dream Mesh内部讨论群。